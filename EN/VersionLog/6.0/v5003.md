# 版本详情

- 版本类型：release
- 版本号：5.0
- 发布日期：2019-02-15


## 后台模块

|     子模块     | 版本号 |          备注          |
|:--------------:|:------:|:----------------------:|
|      gse       | 3.3.6  |        管控平台        |
|      cmdb      | 3.2.2  |        配置平台        |
|      job       | 5.0.3  |        作业平台        |
|   open_paas    | 3.0.94 |        PaaS 平台        |
|   paas_agent   | 3.0.8  |        PaaS 平台        |
|    license     | 3.1.4  |        证书服务        |
| bkdata/dataapi | 1.3.16 |  数据基础模块 api 服务   |
| bkdata/databus | 1.2.30 |  数据基础模块总线服务  |
| bkdata/monitor | 0.2.7  |    蓝鲸监控后台模块    |
|      fta       | 6.0.11 |    故障自愈后台模块    |
|   bknetwork    | 3.6.1  | 网络管理，可源科技提供 |
|      src       |  5.0   |      整包版本信息      |

## SaaS 应用

|       SaaS       | 版本号 |   备注   |
|:----------------:|:------:|:--------:|
|    bk_nodeman    | 1.1.12 | 节点管理 |
| bk_fta_solutions | 6.0.14 | 故障自愈 |
|    bk_monitor    | 1.4.82 | 蓝鲸监控 |
|  bk_log_search   | 2.1.53 | 日志检索 |
|     bk_sops      | 3.1.39 | 标准运维 |

## 版本整体

 - 【新增】全站支持 HTTPS
 - 【新增】PaaS 平台更新超级管理员逻辑验证
 - 【新增】配置平台独立关联关系管理，支持多组字段唯一校验
 - 【新增】管控平台新增进程管理服务，身份同步服务，数据运营监控
 - 【新增】作业平台新增三个脚本相关接口
 - 【新增】标准运维新增同一运维身份执行任务功能，添加原子开发，一键生成命令，流程模板导入导出，节点自动吸附，优化编排体验
 - 【新增】蓝鲸监控支持通过匹配不同启动参数的进程监控，进程端口监控支持 Windows
 - 【新增】节点管理新增插件管理功能，支持非 root 用户安装 Agent
 - 【新增】故障自愈新增组合套餐、标准运维套餐、通知套餐、审批套餐、预警自愈，自愈小助手自动匹配套餐，三个告警源
 - 【变更】从 4.1.16 升级到 5.0 版本，需要重新[运行初始化脚本]否则故障自愈收不到 Zabbix 产生的告警
 - 【变更】HTTPS 为可选配置，若企业没有数字证书认证机构（Certificate Authority，缩写为 CA）颁发的有效证书，请注意调整配置信息为 HTTP 模式

## 已知缺陷

- 【节点管理】当前版本 Windows 主机作为 P-agent 安装异常，后续迭代修复
- 【节点管理】Proxy 暂不支持采用升级方式更新 Agent，要用重装的方式更新 Agent，后续迭代修复
- 【作业平台】常用作业，如果步骤已选择执行 IP，全局 IP 变量会无法覆盖，后续迭代修复
- 【标准运维】职能化人员权限的编辑框暂不支持使用，后续迭代修复
- 【标准运维】动态分组的 IP 全局变量暂无法在执行作业原子中正常显示，后续迭代修复
- 【故障自愈】RESTAPI 推送，同一台机器在不同的云区域，会出现无法收到告警的现象，后续迭代修复
- 【蓝鲸监控】主机监控-进程监控偶现查询进程数不符合所配置的进程信息
  - 解决方案：切换查询时间范围，从 1 小时切换到 24 小时后再切换回去
- 【蓝鲸监控】拨测监控显示时间范围异常，后续迭代修复
- 【配置平台】关联类型页面，没有翻页，查询数量有误，下个迭代修复
- 【配置平台】主机删除历史，切换页面无法回切，下个迭代修复
- 【配置平台】删除模块时，进程对模块的关联不会同时删除，下个迭代修复

## 版本日志

### PaaS 平台

- 【新增】更新 superadmin 验证逻辑
- 【优化】登录桌面调整为 V5.0
- 【优化】常用链接修改
- 【修复】修复文档链接
- 【删除】统一开发环境的信息

### 配置平台

- 【新增】新增模型的关联管理功能
- 【新增】全局模型管理交互页面，支持拖拽方式配置模型之间关联
- 【新增】新增模型的唯一性校验管理功能
- 【新增】新增全局关联类型管理功能
- 【新增】支持多组字段唯一校验
- 【新增】通用实例列表显示属性配置支持还原默认功能
- 【新增】适配 HTTPS
- 【新增】删除模型时加入检测被删模型是否已被实例化，如果已被实例化则禁止删除
- 【新增】导入数据支持数字到字符串的自动转换
- 【变更】移除通过模型字段管理关联的相关配置
- 【变更】移除模型字段中唯一性校验的定义
- 【优化】首页改版
- 【优化】优化导航栏样式和菜单结构，新增“我的收藏”
- 【优化】优化模型管理交互页面
- 【优化】模型拓扑编辑页面优化
- 【优化】实例关联管理不显示对模块的关联
- 【优化】模型列表 ICON 区分内置模型
- 【优化】复制功能使用换行分隔每条数据
- 【优化】mongdb 配置支持集群模式
- 【优化】时区默认改为上海
- 【优化】务拓扑添加字段提示语
- 【优化】关联关系树形图隐藏子网区域
- 【优化】调整事件推送集群、模块分组
- 【优化】归档业务增加变更记录
- 【优化】限制有关联模块的进程删除
- 【优化】自定义查询返回其他业务的数据
- 【优化】语言字段设定为可编辑
- 【优化】进程增加“启动参数匹配规则”字段
- 【优化】HTTP 状态允许使用非 200 的值
- 【优化】事件订阅的创建接口支持 upsert
- 【优化】内置进程模型调整提示内容
- 【优化】增加关联关系存在检测
- 【修复】修复通过云区域 ID 查询主机身份失败问题
- 【修复】修复没有值的字段，显示‘--’问题
- 【修复】修复业务拓扑无法修改每页显示条数问题
- 【修复】修复资源池删除历史界面变更记录隐藏展开/收起按钮失效问题修复通用模型实例中前端展示权限判断错误问题
- 【修复】修复批量修改实例属性，只修改布尔类型的值，无法保存问题
- 【修复】修复日期范围选择器时分秒不准确问题
- 【修复】修复自定义查询保存成功关闭时仍有提示的问题
- 【修复】修复已分配主机判断条件不准确的问题
- 【修复】修复业务权限为空时判断不准确的问题
- 【修复】修复导入模型分组的时候处理空字符串的 bug
- 【修复】修复导入模型字段出错问题
- 【修复】修复读取层级限制参数的 bug
- 【修复】修复表格尺寸切换未重置页码的问题
- 【修复】修复表格拖拽后无法排序的问题
- 【修复】修复拓扑关系修改后未重新刷新表格的问题
- 【修复】修复变更关联参数未清空问题
- 【修复】修复模型属性无法导出问题
- 【修复】修复批量修改时没有勾选必填选项，不输入无法修改保存问题
- 【修复】修复删除模型分类后一直 loading 问题
- 【修复】修复转移主机对应业务错误的问题
- 【修复】修复时间自定义查询时间面板遮挡的问题
- 【修复】修复新建枚举类型字段选项过多时无法保存问题 r 问题
- 【修复】修复保存自定义查询时选择关联字段作为条件会保存失败问题-修复
- 【修复】修复批量转移主机模块，操作审计日志缺少问题
- 【修复】修复动态分组数据返回错误问题
- 【修复】修复批量转移空闲机，主机原有模块未删除问题
- 【修复】修复操作审计未显示业务问题
- 【修复】修复 apache，tomcat 图标错误问题
- 【修复】修复根据时间查询主机，返回时间范围外的主机问题
- 【修复】修复模型属性字段管理会导出内建字段问题
- 【修复】修复查询业务，分页查询不生效问题
- 【修复】修复业务下拥有主机的时候，删除主线模型时会提示“有主机不允许删除”问题
- 【修复】修复后台配置-权限管理-无法单独保存查询权限问题
- 【修复】修复操作审计-有较多记录时查询最早的记录出现失败问题
- 【修复】解决接口创建的模型，没有对英文名称和中文名称做限制问题
- 【修复】解决删除主线模型不删除实例和分组问题
- 【修复】修复资源池根据云区域查询已分配主机无效问题
- 【修复】修复主机查询返回重复的业务、集群、模块信息问题
- 【修复】修复主机查询中查到不应查到的空闲机的信息问题
- 【修复】修复列表字段配置项过多时 UI 异常的问题
- 【修复】修复自定义查询返回其他业务的数据问题
- 【修复】修复批量转移主机模块时，操作审计日志只记录了第一个机器的数据问题
- 【修复】修复新增或更新订阅后不生效问题
- 【修复】解决推送的主机身份事件缺少进程信息问题
- 【修复】解决业务拓扑查询慢问题
- 【修复】解决导入拓扑时没删掉不含 default 字段的模块问题

### 管控平台

- 【新增】进程管理服务程序
- 【新增】身份信息同步服务程序
- 【新增】数据运营监控程序 gse_dataop
- 【新增】Windows Agent 支持无 cygwin 环境执行 Python 脚本
- 【新增】gse 支持高可用部署
- 【优化】on_migrate 新增配置平台的 dataid 初始化
- 【优化】gse 版本号规范化
- 【优化】脚本任务打屏信息长度限制调整为 5M
- 【优化】修改配置模板，支持云区域开发商 id 配置渲染
- 【修复】脚本任务用户组权限问题
- 【修复】P-agent 连接 zk 问题
- 【修复】Proxy 级联缺陷
- 【修复】gse_data 同步 dataid 的问题
- 【修复】gse_syncdata 运行异常问题
- 【修复】Agent 版本号
- 【修复】gse_syncdata 配置模板错误
- 【修复】gse_syncdata 定时同步身份信息 bug
- 【修复】SSL 连接异常关闭问题
- 【修复】Linux Agent 在执行脚本任务账户 home 目录不存在时的日志句柄泄露问题
- 【修复】on_migrate 的配置平台 dataid 初始化

### 作业平台

- 【新增】get_script_list/get_script_detail/get_os_account 三个接口
- 【新增】支持 HTTPS
- 【优化】支持高可用，使用 rabbitmq 保证异常场景下消息不丢失
- 【优化】执行日志存储切换：filesystem-〉mysql
- 【优化】界面优化，脚本编辑器切换为 Ace Editor
- 【优化】API：fast_execute_script 支持用户自定义作业名称
- 【优化】作业导入导出功能优化
- 【优化】日志规范化/日志支持动态配置
- 【修复】特殊场景下，全局参数 -上下文参数和云参功能使用异常的问题

### 标准运维

- 【新增】业务配置中执行者配置新增强制使用功能，可以让运维人员都以同一个运维身份执行任务
- 【新增】添加原子开发 APP 一键生成命令
- 【新增】流程编排连线终点放到节点上自动吸附，优化编排体验
- 【新增】流程模板导入导出功能
- 【修复】全新部署时数据库初始化失败的问题
- 【修复】子流程导出时 404 的问题
- 【修复】子流程删除或更新后，全局变量区没有刷新的问题
- 【修复】子流程输出字段未根据子流程版本进行获取的问题
- 【修复】子流程版本更新后子流程表单值未更新的问题
- 【修复】在忽略错误的状态下节点在内部返回错误时还会进入调度状态的问题
- 【修复】流程编辑中删除打开参数填写框的原子报错的问题
- 【修复】蓝鲸服务(BK)-发送通知原子接入通知渠道后仍然报错的问题
- 【修复】不合法的变量引用语法导致参数渲染报错的问题
- 【修复】流程模板列表新增子流程是否更新的标记
- 【修复】子流程删除或更新后，全局变量区没有刷新的问题
- 【修复】子流程输出字段未根据子流程版本进行获取的问题
- 【修复】子流程版本更新后子流程表单值未更新的问题
- 【修复】在忽略错误的状态下节点在内部返回错误时还会进入调度状态的问题
- 【修复】流程编辑中删除打开参数填写框的原子报错的问题
- 【修复】不合法的变量引用语法导致参数渲染报错的问题

### 蓝鲸监控

- 【新增】 相同二进制程序但服务不同的进程监控，如 zookeeper 和 kafka 的二进制名均为 java，通过启动参数区分不同服务
- 【新增】 进程端口监控支持 Windows
- 【新增】 告警策略动态关联，以最小范围策略为准（优先级：IP>集群或模块>全部集群和模块）
- 【新增】 管理后台进行监控功能配置，可以设置开启或关闭全局 ping 不可达告警功能
- 【新增】 自定义监控支持编辑数据源
- 【优化】 进程或端口信息在 CMDB 变更后自动下发（2 分钟内）至 Agent，无需手动下发配置
- 【优化】 告警检测优化，将检测条件（X 周期内满足 Y 次检测算法）和 收敛规则（告警产生未恢复后 X 小时内不再产生告警）的关系从`或`改成`与`，即检测条件和收敛规则平级
- 【优化】 告警恢复检测，即检测周期的反向条件（如检测条件为 5 个周期内满足 2 次检测算法，则恢复检测为 5 分钟内少于 2 次检测算法）（告警已恢复 状态在后续版本中提供）
- 【优化】 首页和事件中心不再显示收敛状态的告警
- 【优化】 主机监控的默认告警策略，针对新业务生效。
- 【优化】 通知失败的告警会展示失败原因（tooltips）
- 【优化】 组件监控：增加强制跳过测试流程功能
- 【优化】 组件监控：启动采集器成功后自动保存配置
- 【优化】 组件监控：下发 datadog 采集器前预先判断目标机器 Python 版本
- 【优化】 日志采集：IP 选用使用 IP 选择器
- 【修复】 主机属于多集群或多模块不告警
- 【修复】 主机监控配置主备负责人使用模块负责人导致通知失败的问题
- 【修复】 组件监控：连通性测试删除主机列表错误的问题
- 【修复】 组件监控：未安装 Cygwin 的 Windows 机器在测试流程提示"sleep"命令不存在的问题
- 【修复】 组件监控：在 ORACLE 组件描述中点击下载 ORACLE RPM 包会跳转到空白页的问题
- 【修复】 自定义组件导入：当设置的采集周期大于 1 分钟时，图表数据呈现为断点的问题
- 【修复】 自定义组件导入：下发 start.sh 脚本启动参数缺失的问题
- 【修复】 业务管理：通知分组人员列表为空时仍可保存的问题
- 【修复】 拨测策略编辑：监控指标为响应时间，高级选项为部分节点数，会导致策略无法保存的问题

### 节点管理

- 【新增】插件管理功能，支持 64 位操作系统下插件状态查看，插件的进城管理及二进制更新操作
- 【新增】支持非 root 用户安装 Agent
- 【新增】任务超时设置，适应低带宽环境的 Agent 安装
- 【优化】当一台机器已安装在另一个业务下时，提示用户，不进行安装
- 【优化】优化移除节点流程
- 【优化】在 Windows 机器上卸载 Agent 时尝试使用“system”帐户，而不是“System”帐户来调作业平台
- 【优化】其他若干界面优化及提示信息优化
- 【修复】P-Agent 安装中使用密钥文件安装失败的问题
- 【修复】若干安装 Agent 的 bug
- 【变更】“移除”功能不进行卸载，只将节点管理中的机器信息删除

### 故障自愈

- 【新增】 组合套餐，支持将原子套餐组装成组合套餐，支持复杂故障处理场景
- 【新增】 标准运维套餐，告警处理支持调用标准运维流程
- 【新增】 通知套餐，自定义通知内容
- 【新增】 审批套餐，重要告警需人工确认才能进行下一步处理
- 【新增】 3 种告警源集成，支持处理来源于 AWS、Icinga 2、邮件中的告警
- 【新增】 预警自愈，频繁故障的资源可进一步处理
- 【新增】 自愈小助手，匹配接入的告警类型和套餐作为自愈
- 【优化】 后台去掉证书逻辑
- 【优化】 关闭蓝鲸监控默认套餐
- 【优化】 表格样式调整
- 【修复】 告警收敛失效 关联告警未创建导致
- 【修复】 告警源管理界面无法显示出错的告警源
- 【修复】 审批套餐不可用缺陷
- 【修复】 操作审计无数据记录
- 【修复】 REST API 推送告警示例描述缺少-k 选项
