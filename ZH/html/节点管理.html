
    <html lang="zh-cn">
    <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <link href="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/default.css" rel="stylesheet">
    </head>
    <body>
    <h1 id="_1">产品简介</h1>
<p>节点管理是一款帮助企业批量快速安装蓝鲸 Agent 的 SaaS 应用，支持对常见的 Linux、Windows、AIX （仅限企业版）操作系统进行自动化部署，提供了跨云管理的安装部署方案，帮助企业轻松应对多云区域的 IaaS 设备管控。</p><h1 id="_1">基本概念</h1>
<h2 id="_2">云区域</h2>
<p>互相之间能直接通信的一组服务器单元，如企业内的局域网、公有云 VPC（虚拟私有网络）。</p>
<h2 id="proxy">Proxy</h2>
<p>云区域对外通信的代理节点。在非直连的云区域，需要安装 Proxy 让蓝鲸可以连接到这个区域下的主机进行管控。为了负载均衡和容灾的考虑，您可以在一个云区域中安装多个 Proxy。</p>
<h2 id="agent">Agent</h2>
<p>蓝鲸 Agent，是实现主机与蓝鲸通讯的专用程序。在主机上安装了了蓝鲸 Agent 以后，您可以通过蓝鲸对主机管控，包含文件分发、作业执行、数据上报、基础信息采集等。</p>
<h2 id="_3">插件</h2>
<p>插件是可由蓝鲸 Agent 调度的子程序或者脚本。您可以通过获取插件开发框架，自定义出有特定功能的插件，通过节点管理下发部署到主机上，拓展更多有业务、企业特性的管控功能。</p>
<h2 id="_4">接入点</h2>
<p>Agent 通过接入点与蓝鲸建立通讯连接，接入点可以直接对于其连接的 Agent 下发管控指令、文件分发等。</p>
<p>如果您的主机资源在地理上跨越较大，可以在不同的地域部署多套接入点，提高文件传输速率、降低跨区域带宽成本、降低指令延迟等。</p>
<p>蓝鲸初次部署完成，会包含一个默认的接入点。</p><h1 id="_1">产品架构</h1>
<p>节点管理是基于 SSH 通信链路或者 Windows 的 3389 远程端口，实现批量主机的 Agent 安装。</p>
<p>如果企业需要管理不同区域(云)的主机，只需要每个区域提供一台带有外网 IP 的 Linux 主机作为代理(Proxy)主机，同区域内其他云主机只需要和 Proxy 通信就可以实现跨云管理。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Introduce/media/a219aaeefb7408dd1e4b45c7c942f767.png" /></p><h1 id="_1">特点及优势</h1>
<h2 id="_2">灵活的安装方式</h2>
<p>提供密码、密钥安装方式，为了保证安全，密码会做加密传输，并且一天后自动清除密码和密钥文件，保证密码和密钥的安全。</p>
<h2 id="_3">跨云部署</h2>
<p>默认提供直连区域(蓝鲸平台和需要管控的主机在同一片网络区域)的安装方式，如果企业需要管控多片云区域主机，只需要自定义添加云区域，然后选择或者导入主机进行安装。</p>
<h2 id="_4">实时安装日志</h2>
<p>将安装过程中每一步的日志实时地打印出来，方便定位安装过程中遇到的问题。</p>
<h2 id="_5">支持多种操作系统</h2>
<p><strong>Linux 主机</strong>：支持主流的 Linux 操作系统，包括但不限于 Centos、Ubuntu、SuSe、debian、深度系统、中标麒麟等。</p>
<p><strong>Windows 主机</strong>：支持 Windows server 系列服务器，包括但不限于 2008、2012 等。</p>
<p><strong>AIX 主机(仅限企业版)</strong>：支持 AIX 6/7 系列服务器。</p><h1 id="agent">安装蓝鲸 Agent（直连区域）</h1>
<h2 id="_1">步骤一：确认接入点配置</h2>
<p>点击“全局配置”，确认默认接入点的以下配置不为空，且将要安装蓝鲸 Agent 的目标主机可连接到这些配置的内网地址。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/QuickStart/media/20200604152835.png" /></p>
<h2 id="agent_1">步骤二：开始远程安装 Agent</h2>
<p>切换到“Agent 管理”页，点击“安装 Agent”按钮。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/QuickStart/media/20200604153148.png" /></p>
<p>安装业务选择已经在配置平台创建的业务，如暂时无业务，可以选择“资源池”。</p>
<p>云区域选择“直连区域”，接入点使用默认接入点。</p>
<p>然后补全安装的目标主机详情配置。完成后点击“安装”开始执行安装任务。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/QuickStart/media/20200604153241.png" /></p>
<h2 id="_2">步骤三：查看执行状态</h2>
<p>步骤二完成后，会自动跳转到任务页面，等待 Agent 安装成功。如果任务失败，可以点击主机查看安装日志。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/QuickStart/media/20200604153623.png" /></p><h1 id="agent">安装蓝鲸 Agent（自定义云区域）</h1>
<p>背景：当需要安装 Agent 的目标主机不可以被蓝鲸服务直接访问到，需要通过创建自定义云区域的方式进行安装 Agent。</p>
<h2 id="_1">步骤一：确认接入点配置</h2>
<p>点击“全局配置”，确认默认接入点的以下配置不为空，且将要安装蓝鲸 Agent 的目标主机可连接到这些配置的内网地址。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/QuickStart/media/20200604152835.png" /></p>
<h2 id="_2">步骤二：创建云区域</h2>
<p>在云区域管理页面，点击“新建”按钮开始创建一个新的云区域。云区域参数解释：</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/QuickStart/media/20200604100613.png" /></p>
<p>成功提交以后，系统会提示“继续安装 Proxy”。选择“继续安装 Proxy”配置 Proxy。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/QuickStart/media/20200604100832.png" /></p>
<p>按照指引填写 Proxy 安装参数，点击安装进入到任务详情页，等待安装成功以后，进行下一步。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/QuickStart/media/20200604100902.png" /></p>
<h2 id="agent_1">步骤三：安装 Agent</h2>
<p>切换到“Agent 管理”页，点击“安装 Agent”按钮。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/QuickStart/media/20200604153148.png" /></p>
<p>安装业务选择已经在配置平台创建的业务，如暂时无业务，可以选择“资源池”。</p>
<p>云区域选择刚刚创建的云区域，接入点使用默认接入点。</p>
<p>然后补全安装的目标主机详情配置。完成后点击“安装”开始执行安装任务。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/QuickStart/media/20200604154549.png" /></p>
<h2 id="_3">步骤四：查看执行状态</h2>
<p>步骤三完成后，会自动跳转到任务页面，等待 Agent 安装成功。如果任务失败，可以点击主机查看安装日志。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/QuickStart/media/20200604153623.png" /></p><h1 id="agent">Agent 管理</h1>
<p>蓝鲸平台所在服务器和需要安装 Agent 的主机同属于一片网络区域时，填写/选择主机、端口、密码/密钥信息后可以直接安装蓝鲸 Agent，安装 Agent 需要保证目标机器的 SSH 通道是打开的。</p>
<h2 id="agent_1">Agent 状态查询</h2>
<p>进入到 Agent 管理页，会显示当前账户有查询权限的所有 Agent 状态。</p>
<p><img alt="1590650634912" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/1590650634912.png" /></p>
<p>当前支持按业务、云区域、IP、操作系统、状态等属性进行筛选。</p>
<p><img alt="1590651439808" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/1590651439808.png" /></p>
<h2 id="agent_2">新主机安装 Agent</h2>
<p>当需要在新主机上安装蓝鲸 Agent，并且已知主机的 SSH 登录账户密码，有可以参考以下步骤进行，此操作同时会把主机注册到蓝鲸配置平台中。</p>
<ol>
<li>点击安装 Agent 按钮，选择“普通安装”</li>
</ol>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200603194710.png" /></p>
<ol>
<li>
<p>填写安装参数，参数说明如下：</p>
</li>
<li>
<p>安装到业务：主机安装 Agent 以后，需指定录入到蓝鲸配置平台的哪个业务，默认会放置到业务下的 “/空闲池/空闲机” 下</p>
</li>
<li>云区域：主机需要被指定属于哪个云区域，如果蓝鲸所部署的环境可以直接连接到此主机，没有网络隔离，选择“直连区域”。如果公司有复杂的网络划分，蓝鲸无法直接连接到此主机，需要先在“云区域管理”做好网络规划，再进行 Agent 的安装</li>
<li>接入点：此配置一般在云区域中默认指定，部分未指定接入点的云区域需要用户手动选择</li>
<li>安装信息：<ul>
<li>IP 地址：蓝鲸连接到此主机使用的 IP 地址</li>
<li>登录 IP：蓝鲸安装 Agent 时，登录的 IP 地址。此参数可以为空，通常此地址与第一个参数“IP 地址”一致。如果存在不一致，才需要填写此参数</li>
<li>操作系统：此主机安装的操作系统类型，由于不同操作系统登录的方式有所差异，请务必填写正确</li>
<li>登录端口：通常 SSH 登录端口为 22，端口错误会导致无法正常登录安装</li>
<li>登录账户：Linux 请使用 root 账户，Windows 请使用 Administrator</li>
<li>认证方式：目前支持“密码”和“密钥”两种方式，选择密钥需要上传密钥文件。这些敏感信息，为了保证安全的同时避免用户重复输入，节点管理默认保存 24 小时，超时以后会删除登录账号信息</li>
</ul>
</li>
</ol>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200603194949.png" /></p>
<ol>
<li>
<p>完整配置以后，点击底部的“安装”按钮继续。</p>
<p>此时节点管理会验证录入的“云区域+IP 地址”组合，是否已经存在蓝鲸中，如果已经存在，安装程序将会忽略这批主机，并有对话框提示信息。</p>
</li>
</ol>
<h2 id="agent_3">新主机通过导入安装 Agent</h2>
<p>上个小节中，描述了一般情况下安装 Agent 的步骤，当您想要安装的 Agent 网络环境差异过大，数量较多，在节点管理的交互界面中比较难编辑，或者您已经有主机信息的表格，可以使用 Excel 导入的方式进行安装。</p>
<p>操作步骤如下：</p>
<ol>
<li>点击安装 Agent 按钮，选择“Excel 导入安装”。</li>
</ol>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200603202949.png" /></p>
<ol>
<li>下载模版，根据模版的提示要求，补充主机的信息，然后上传。需要注意通过 Excel 导入的方式，“认证资料”只能够填写密码的方式，您如果使用密钥登录，可以先填写无效密码，到下个步骤中再修改为密钥方式。</li>
</ol>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200603203124.png" /></p>
<ol>
<li>确认主机详情信息，节点管理会识别出当前 Excel 文件中的格式，确认无误点击安装即可。</li>
</ol>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200603204957.png" /></p>
<h2 id="agent_4">Agent 维护</h2>
<p>当 Agent 安装以后，日常的维护包含重装、重启、卸载、移除等，可以在列表中选择目标主机，点击更多进行操作。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200603204223.png" /></p><h1 id="_1">插件管理</h1>
<p>插件是可由蓝鲸 Agent 调度的子程序或者脚本。蓝鲸 Agent 在安装到主机的时候会包含一些蓝鲸必备插件。</p>
<p>您可以通过插件管理功能更新这些插件，或者安装更多可选插件。</p>
<h2 id="_2">插件状态查询</h2>
<p>点击主导航的“插件管理”进入到插件管理页面，在此页面中，您可以查询到当前主机的各个插件状态和版本号。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604105818.png" /></p>
<h2 id="_3">插件维护和安装</h2>
<p><strong>第一步：选择操作目标</strong></p>
<p>选中需要管理的主机，点击下一步进入到管理页面。</p>
<p>注意：当前不支持 Windows 和 Linux 主机混合选中，建议先使用右上角的筛选功能先过滤操作系统，再进行选中维护。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604111130.png" /></p>
<p><strong>第二步：选择操作</strong></p>
<p>选择需要进行的操作和插件，即可以对插件进行操作。</p>
<p>对插件的维护包含以下操作：</p>
<ul>
<li>启动：安装并启动插件程序</li>
<li>停止：停止插件功能</li>
<li>重启：重启插件程序，需插件支持</li>
<li>重载：通常用于配置更新，需插件支持</li>
<li>托管：托管给 Agent 管理后，当插件程序异常退出，Agent 会自动拉起此插件</li>
<li>取消托管：不使用托管功能</li>
<li>插件更新：更新插件到最新版本</li>
</ul>
<p><img alt="image-20201105120206133" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/media/Plugin/image-20201105120206133.png" /></p>
<h2 id="_4">添加新的插件包到节点管理</h2>
<p><strong>第一步：获取插件包</strong></p>
<p>您可以通过以下途径获取到插件包：</p>
<ol>
<li>蓝鲸官网的<a href="https://bk.tencent.com/s-mart/">Smart 市场</a></li>
<li>通过插件开发框架自定义开发的插件</li>
</ol>
<p><strong>第二步：上传插件包</strong></p>
<p>获取新的插件包以后，需要上传到蓝鲸所部署的主机以下路径中：</p>
<p><code>$BK_HOME/bknodeman/nodeman/official_plugin</code></p>
<p><strong>第三步：刷新插件包</strong></p>
<p>还是在蓝鲸部署主机上，执行以下指令，刷新插件包到节点管理中。</p>
<pre class="codehilite"><code class="language-bash">workon bknodeman-nodeman
./bin/manage.sh init_official_plugins</code></pre><h1 id="_1">云区域管理</h1>
<p>云区域是互相之间能直接通信的一组服务器单元，如企业内的局域网、公有云 VPC（虚拟私有网络）。</p>
<p>蓝鲸初始部署的时候，默认会创建“直连区域”，当主机可以直接与蓝鲸部署所在网络直接进行通讯连接时，Agent 安装到此区域即可。</p>
<p>如果企业网络有区域划分，如办公网与生产网络隔离、总公司与分公司网络隔离、国内服务网与国外服务网隔离等情况，可根据实际的网络可连通性规划创建多个云区域。</p>
<h2 id="_2">查看云区域</h2>
<p>点击导航“云区域管理”可以查看当前已经存在的云区域。蓝鲸初始部署完成，此列表为空。需要注意云区域查看需要获得授权。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604101308.png" /></p>
<h2 id="_3">创建云区域</h2>
<p><strong>第一步：创建云区域。</strong></p>
<p>在云区域管理页面，点击“新建”按钮开始创建一个新的云区域。云区域参数解释：</p>
<ul>
<li>云区域名称：云区域的唯一标识，在蓝鲸中，此名称需唯一</li>
<li>云服务商：用于标识当前网络的提供商，对于企业私有网络，选择企业私有云，对于公有云提供的网络，蓝鲸默认已经提供国内外常见的厂商列表可供选择</li>
<li>接入点：当在“全局配置”中存在多个接入点，用户可以定义当前云区域通过哪个接入点与蓝鲸通讯</li>
</ul>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604100613.png" /></p>
<p><strong>第二步：成功提交以后，系统会提示“继续安装 Proxy”。</strong></p>
<p>由于自定义的云区域存在网络隔离，在未安装 Proxy 之前，不可以继续在其下安装 Agent，所以建议选择“继续安装 Proxy”配置 Proxy。</p>
<p>如果您还没有准备好 Proxy 的网络或主机资源，也可在后续任何时候进入到云区域管理中进行 Proxy 的安装。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604100832.png" /></p>
<p><strong>第三步：填写 Proxy 安装参数</strong></p>
<p>安装所需要的参数详情解释如下：</p>
<ul>
<li>内网 IP：与 Agent 可以进行网络通讯的 IP</li>
<li>对外通讯 IP：与接入点可以进行网络通讯的 IP</li>
<li>登录 IP：从蓝鲸可以 SSH 登录到此 Proxy 主机的 IP。此为可选配置，如果没有填写默认使用内网 IP</li>
<li>认证方式：支持密码或者密钥的方式</li>
<li>操作系统：作为 Proxy 的主机必须为 64 位的 Linux 系统</li>
<li>登录端口：可以进行 SSH 连接的端口</li>
<li>登录账号：建议为 root 账户，如果不能够使用 root 账户，要求所填写账户可以免密 sudo 执行 /tmp/setup_agent.sh 脚本</li>
<li>归属业务：用于定义 Proxy 安装完成后，录入到蓝鲸配置平台的哪个业务下。需要注意的是，您必须获取蓝鲸配置平台的业务权限才可以进行此操作</li>
</ul>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604100902.png" /></p>
<h2 id="proxy">Proxy 查询</h2>
<p>云区域安装完成以后，可以点击云区域标题查看云区域下 Proxy 详情。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604104408.png" /></p>
<p>如在此前没有安装过 Proxy，您可以点击新建继续安装 Proxy。</p>
<p>如果已经存在 Proxy，您也可以根据企业的实际需要，决定是否安装多个 Proxy，以达到更高的可用性、负载均衡要求。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604104513.png" /></p>
<h2 id="proxy_1">卸载 Proxy</h2>
<p>卸载云区域的 Proxy，可以点击云区域名称查看已经存在的 Proxy。</p>
<p>在卸载之前需要确认当前 Proxy 没有 Agent 与其连接。否则会导致失败。</p>
<h2 id="_4">删除云区域</h2>
<p>删除云区域之前您需要先确认当前云区域下的 Proxy 已经完全卸载。</p><h1 id="_1">任务历史</h1>
<p>由于节点管理大部分任务都是异步进行，耗时较长，此功能可以帮助查询节点管理曾经进行过的任务状态和任务日志。</p>
<h2 id="_2">查看任务历史列表</h2>
<p>包含 Agent、Proxy、插件的操作任务列表。通常按照业务、执行人进行筛选出任务详情。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604151141.png" /></p>
<h2 id="_3">任务详情</h2>
<p>点击单个任务，可以查看到任务详情，包含当前任务下执行的子任务状态，如批量给主机安装蓝鲸 Agent 可以查看到每个主机安装状态。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604151323.png" /></p>
<p>需要查询每个子任务的执行日志，可以再次点击进入到日志详情中查看。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604151350.png" /></p><h1 id="_1">全局配置</h1>
<p>全局配置是节点管理通用的配置，一般为管理员设置。</p>
<p>分为 GSE 环境配置和任务配置两个板块。</p>
<h2 id="gse">GSE 环境配置</h2>
<p>每个接入点有独立的 GSE 环境配置，蓝鲸初始部署完成包含一个默认接入点。</p>
<p>接入点的相关参数：</p>
<ul>
<li>地域信息：标注当前接入点的区域 ID、城市 ID。完善后蓝鲸 Agent 可对比主机上地域、城市自动选择最优接入点</li>
<li>BtfileServer：BT 文件传输服务地址</li>
<li>DataServer：数据管道服务地址</li>
<li>TaskServer: 任务管道服务地址</li>
<li>安装包：Agent 的安装包所在地址，需要确认这个地址是可以被主机访问。其中内网地址用于直连区域主机连接。外网地址用于非直连主机连接</li>
</ul>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604143727.png" /></p>
<h2 id="_2">任务配置</h2>
<p>部署任务的常见参数配置。</p>
<p><img alt="-w2020" src="F:\v_awjliu\社区版文档\BlueKingDocsTest\ZH/6.0/节点管理/产品白皮书/Feature/media/20200604150740.png" /></p>
    </body>
    </html>
    