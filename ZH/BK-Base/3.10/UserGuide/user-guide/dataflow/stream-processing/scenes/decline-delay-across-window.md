## 减少窗口节点间的延迟

数据开发当前的窗口计算采用数据驱动。

## 典型案例

![](../../../../assets/dataflow/stream-processing/dataflow-stream-windows.png)

上图中有两个实时计算节点，窗口节点`f25963_window1`和窗口节点`f25963_window2`，其窗口配置相同：

![](../../../../assets/dataflow/stream-processing/dataflow-stream-windows-config.png)

窗口节点`f25963_window2`触发第 N 个窗口计算的时机在节点`f25963_window1`触发第 N+1 个窗口的时候。以数据示例加以说明如下。

- 假设数据上报无延迟
- 假设上游节点从输出到输入到下游节点间无延迟 

|      本地时间       | 数据源上报的数据时间 | `f25963_window1`数据时间 | `f25963_window2`数据时间 |
| :-----------------: | :------------------: | :----------------------: | :----------------------: |
| 2020-01-01 00:00:00 | 2020-01-01 00:00:00  |                          |                          |
| 2020-01-01 00:01:00 | 2020-01-01 00:01:00  |                          |                          |
| 2020-01-01 00:02:00 | 2020-01-01 00:02:00  |                          |                          |
| 2020-01-01 00:03:00 | 2020-01-01 00:03:00  |                          |                          |
| 2020-01-01 00:04:00 | 2020-01-01 00:04:00  |                          |                          |
| 2020-01-01 00:05:00 | 2020-01-01 00:05:00  |   2020-01-01 00:00:00    |                          |
| 2020-01-01 00:06:00 | 2020-01-01 00:06:00  |                          |                          |
| 2020-01-01 00:07:00 | 2020-01-01 00:07:00  |                          |                          |
| 2020-01-01 00:08:00 | 2020-01-01 00:08:00  |                          |                          |
| 2020-01-01 00:09:00 | 2020-01-01 00:09:00  |                          |                          |
| 2020-01-01 00:10:00 | 2020-01-01 00:10:00  |   2020-01-01 00:05:00    |   2020-01-01 00:00:00    |
| 2020-01-01 00:11:00 | 2020-01-01 00:11:00  |                          |                          |
| 2020-01-01 00:12:00 | 2020-01-01 00:12:00  |                          |                          |
|         ...         |         ...          |           ...            |           ...            |

后置计算节点需要前置计算节点输出数据的驱动，可看到：

- 窗口节点`f25963_window1`每分钟输出一个窗口的结果数据，现象为**数据延迟 5 分钟输出**
- 窗口节点`f25963_window2`也是每分钟输出一个窗口的结果数据，但相比于数据源，现象为**数据延迟 10 分钟输出**

## 降低延迟的方式

`f25963_window2`可认为在定时输出有序数据，在后置节点也配置了相同窗口、相同统计频率的情况下，可认为后置节点的等待略显多余。因此，可将节点`f25963_window2`设置为会话窗口，通过对过期时间的合理配置，**尽快**推动下游节点的窗口计算。

### 配置说明

窗口间隔时间和过期时间之和应小于上游节点的统计频率

- 间隔时间

  由于上游按窗口批次输出，当前节点需要计算上游一个批次的数据，而上游批次的数据时间是一样的，因此间隔时间可设置为 0

- 过期时间

  过期时间是一个会话窗口长时间没有数据进行推动，自动触发计算的**本地等待时间**配置，因此可将该值设置为除 0 之外较小的值 

### 案例配置示例

根据案例，可以配置如下的会话窗口：

![](../../../../assets/dataflow/stream-processing/dataflow-stream-windows-session.png)
